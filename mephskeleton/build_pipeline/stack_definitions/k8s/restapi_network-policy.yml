apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: mephskeleton-restapi
  namespace: mango
spec:
  podSelector:
    matchLabels:
      k8s-app: mephskeleton-restapi
  ingress:
    # Prometheus traffic ingress for custom
    # metrics monitoring
    - ports:
        - port: http
      from:
        # Allow access from Prometheus
        - podSelector:
            matchLabels:
              prometheus: k8s
          namespaceSelector:
            matchLabels:
              role: monitoring
    - ports:
        - port: http
      from:
        # Allow access from Traefik
        - podSelector:
            matchLabels:
              k8s-app: traefik-ingress-controller
          namespaceSelector:
            matchLabels:
              role: ingress
